[{"content":"系统环境 操作系统: Ubuntu 22.04.3 CUDA环境: 12.8 NVIDIA驱动: 570.124.06 cuDNN版本: 9.10.1 一. cuDNN安装步骤 1. 下载cuDNN 历史版本下载: https://developer.nvidia.com/cudnn-archive\n最新版本下载: https://developer.nvidia.com/rdp/cudnn-download\n使用wget下载安装包：\n1 wget https://developer.download.nvidia.com/compute/cudnn/9.10.1/local_installers/cudnn-local-repo-ubuntu2204-9.10.1_1.0-1_amd64.deb 2. 安装cuDNN包 1 dpkg -i cudnn-local-repo-ubuntu2204-9.10.1_1.0-1_amd64.deb 3. 添加密钥并安装 复制密钥文件：\n1 sudo cp /var/cudnn-local-repo-ubuntu2204-9.10.1/cudnn-*-keyring.gpg /usr/share/keyrings/ 更新包列表并安装：\n1 2 3 4 5 6 7 sudo apt-get update sudo apt-get -y install cudnn cd /var/cudnn-local-repo-ubuntu2204-9.10.1/ dpkg -i libcudnn9-samples_9.10.1.4-1_all.deb dpkg -i libcudnn9-cuda-12_9.10.1.4-1_amd64.deb dpkg -i libcudnn9-dev-cuda-12_9.10.1.4-1_amd64.deb dpkg -i libcudnn9-headers-cuda-12_9.10.1.4-1_amd64.deb 二. 环境验证 1. 版本验证 使用以下命令检查cuDNN版本：\n1 cat /usr/include/x86_64-linux-gnu/cudnn_version.h | grep CUDNN_MAJOR -A 2 根据输出结果，系统中已经成功安装了cuDNN版本9.10.1。\n2. 查看安装文件路径(如果找不到文件可参考此步骤) 使用dpkg命令查看安装的文件路径：\n1 dpkg -L \u0026lt;version\u0026gt; 3. 运行示例程序 进入cuDNN示例目录并编译测试：\n1 2 3 cd /usr/src/cudnn_samples_v9/mnistCUDNN make clean \u0026amp;\u0026amp; make ./mnistCUDNN FAQ: 如果在make编译过程中提示缺少FreeImage.h，请运行： 1 sudo apt-get install libfreeimage3 libfreeimage-dev ","permalink":"https://www.itwp.cn/categories/article/cudnn01/","summary":"\u003ch2 id=\"系统环境\"\u003e系统环境\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e操作系统: Ubuntu 22.04.3\u003c/li\u003e\n\u003cli\u003eCUDA环境: 12.8\u003c/li\u003e\n\u003cli\u003eNVIDIA驱动: 570.124.06\u003c/li\u003e\n\u003cli\u003ecuDNN版本: 9.10.1\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"一-cudnn安装步骤\"\u003e一. cuDNN安装步骤\u003c/h2\u003e\n\u003ch3 id=\"1-下载cudnn\"\u003e1. 下载cuDNN\u003c/h3\u003e\n\u003cp\u003e历史版本下载: \u003ca href=\"https://developer.nvidia.com/cudnn-archive\"\u003ehttps://developer.nvidia.com/cudnn-archive\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e最新版本下载: \u003ca href=\"https://developer.nvidia.com/rdp/cudnn-download\"\u003ehttps://developer.nvidia.com/rdp/cudnn-download\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e使用wget下载安装包：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-0-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://developer.download.nvidia.com/compute/cudnn/9.10.1/local_installers/cudnn-local-repo-ubuntu2204-9.10.1_1.0-1_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"2-安装cudnn包\"\u003e2. 安装cuDNN包\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-1-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edpkg -i cudnn-local-repo-ubuntu2204-9.10.1_1.0-1_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"3-添加密钥并安装\"\u003e3. 添加密钥并安装\u003c/h3\u003e\n\u003cp\u003e复制密钥文件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-2-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo cp /var/cudnn-local-repo-ubuntu2204-9.10.1/cudnn-*-keyring.gpg /usr/share/keyrings/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e更新包列表并安装：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-3-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-3-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-2\"\u003e2\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-3-3\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-3\"\u003e3\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-3-4\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-4\"\u003e4\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-3-5\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-5\"\u003e5\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-3-6\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-6\"\u003e6\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-3-7\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-7\"\u003e7\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get -y install cudnn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /var/cudnn-local-repo-ubuntu2204-9.10.1/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edpkg -i libcudnn9-samples_9.10.1.4-1_all.deb \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edpkg -i libcudnn9-cuda-12_9.10.1.4-1_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edpkg -i libcudnn9-dev-cuda-12_9.10.1.4-1_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edpkg -i libcudnn9-headers-cuda-12_9.10.1.4-1_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"二-环境验证\"\u003e二. 环境验证\u003c/h2\u003e\n\u003ch3 id=\"1-版本验证\"\u003e1. 版本验证\u003c/h3\u003e\n\u003cp\u003e使用以下命令检查cuDNN版本：\u003c/p\u003e","title":"Ubuntu安装CuDNN 9.10.1"},{"content":"🚧 内容准备中 感谢您访问我的博客！ 日常分类的内容正在精心准备中\u0026hellip;\u0026hellip;\n","permalink":"https://www.itwp.cn/categories/everyday/preparing/","summary":"\u003ch3 id=\"-内容准备中\"\u003e🚧 内容准备中\u003c/h3\u003e\n\u003cp\u003e感谢您访问我的博客！\n日常分类的内容正在精心准备中\u0026hellip;\u0026hellip;\u003c/p\u003e","title":""},{"content":"个人经历 本人精通 NVIDIA Infiniband ROCE V2 AIGC Kubernetes 等单词的拼写\n精通 Windows Linux Ubuntu Mac IOS 等系统的开关机\nLinux工程师 北京乐讯科技有限公司 · 北京 2021.6 - 至今 万卡GPU集群搭建和运维（ROCE V2） 多个千卡GPU集群搭建和运维（Infiniband、ROCE V2） AIGC集群并行优化和包管理（Infiniband、ROCE V2） ","permalink":"https://www.itwp.cn/categories/about/about-me/","summary":"\u003ch3 id=\"个人经历\"\u003e个人经历\u003c/h3\u003e\n\u003cp\u003e本人精通 NVIDIA Infiniband ROCE V2 AIGC Kubernetes 等单词的拼写\u003c/p\u003e\n\u003cp\u003e精通 Windows Linux Ubuntu Mac IOS 等系统的开关机\u003c/p\u003e\n\u003cdiv class=\"experience-item\"\u003e\n  \u003cdiv class=\"experience-header\"\u003e\n    \u003cdiv class=\"experience-info\"\u003e\n      \u003ch4 class=\"experience-title\"\u003e\n        Linux工程师\n        \u003ca\n          href=\"mailto:miaopu980516@gmail.com\"\n          class=\"email-icon\"\n          title=\"通过邮件联系我\"\n          aria-label=\"发送邮件给我\"\n        \u003e\n          \u003csvg\n            width=\"16\"\n            height=\"16\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n            aria-hidden=\"true\"\n          \u003e\n            \u003cpath\n              d=\"M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z\"\n              fill=\"currentColor\"\n            /\u003e\n          \u003c/svg\u003e\n        \u003c/a\u003e\n      \u003c/h4\u003e\n      \u003cp class=\"experience-company\"\u003e\n        \u003ca\n          href=\"https://www.lexun.ltd/\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        \u003e\n          北京乐讯科技有限公司\n        \u003c/a\u003e\n        \u003cspan class=\"location-separator\"\u003e · \u003c/span\u003e\n        \u003cspan class=\"experience-location\"\u003e北京\u003c/span\u003e\n      \u003c/p\u003e\n    \u003c/div\u003e\n    \u003ctime class=\"experience-duration\" datetime=\"2021-06\"\u003e 2021.6 - 至今 \u003c/time\u003e\n  \u003c/div\u003e\n  \u003cul class=\"experience-duties\"\u003e\n    \u003cli\u003e万卡GPU集群搭建和运维（ROCE V2）\u003c/li\u003e\n    \u003cli\u003e多个千卡GPU集群搭建和运维（Infiniband、ROCE V2）\u003c/li\u003e\n    \u003cli\u003eAIGC集群并行优化和包管理（Infiniband、ROCE V2）\u003c/li\u003e\n  \u003c/ul\u003e\n\u003c/div\u003e","title":""},{"content":"场景描述 OS： openEuler 22.03 SP3\n项目操作系统使用openEuler 22.03 SP3，在进行跨节点 nccl-test 测试的时候发现 nvidia-peermem 无法加载使用RDMA。\n注意： H200节点跨节点通信只有100+GB，因为没有开启GDR，所以默认走PCIE，链路瓶颈就在于PCIE\n测试参数及带宽如下 1 2 3 4 5 6 7 8 9 10 11 12 13 mpirun \\ --allow-run-as-root \\ --prefix /usr/local/openmpi \\ -H 1.1.1.1:8,1.1.1.2:8 \\ -mca btl_tcp_if_exclude lo,docker0 \\ -x LD_LIBRARY_PATH=/usr/local/cuda/lib64:/usr/local/openmpi/lib/:/root/test_env/nccl/build/lib/ \\ -x PATH \\ -x NCCL_IB_DISABLE=0 \\ -x NCCL_IB_HCA=mlx5_0,mlx5_1,mlx5_2,mlx5_3,mlx5_4,mlx5_7,mlx5_8,mlx5_9 \\ -x NCCL_DEBUG=INFO \\ -x NCCL_IB_QPS_PER_CONNECTION=8 \\ -x NCCL_SOCKET_IFNAME=bond4.24 \\ ./build/all_reduce_perf -b 8M -e 8G -g 1 -f 2 问题解决 从GitHub拉取nvidia-peermem进行编译\n1. 拉取nvidia-peermem源码 1 sudo git clone https://github.com/Mellanox/nv_peer_memory.git 2. 编译并安装nv_peer_mem.ko 1 2 3 4 cd nv_peer_memory \u0026amp;\u0026amp; make cp nv_peer_mem.ko /lib/modules/$(uname -r)/kernel/drivers/video depmod -a modprobe nv_peer_mem 3. 检查模块加载状态 1 2 # 可通过lsmod|grep nv_peer_mem检查 lsmod|grep nv_peer_mem 加载模块后的测试结果 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mpirun \\ --allow-run-as-root \\ --prefix /usr/local/openmpi \\ -H 1.1.1.1:8,1.1.1.2:8 \\ -mca btl_tcp_if_exclude lo,docker0 \\ -x LD_LIBRARY_PATH=/usr/local/cuda/lib64:/usr/local/openmpi/lib/:/root/test_env/nccl/build/lib/ \\ -x PATH \\ -x NCCL_IB_DISABLE=0 \\ -x NCCL_IB_HCA=mlx5_0,mlx5_1,mlx5_2,mlx5_3,mlx5_4,mlx5_7,mlx5_8,mlx5_9 \\ -x NCCL_IB_QPS_PER_CONNECTION=8 \\ -x NCCL_ALGO=Ring \\ -x NCCL_DEBUG=INFO \\ -x NCCL_SOCKET_IFNAME=enp25s0np0 \\ -x NCCL_IB_TC=160 \\ -x NCCL_NET_GDR_LEVEL=4 \\ ./build/all_reduce_perf -b 4G -e 32G -g 1 -n 20 -w 5 总结 通过编译和加载nvidia-peermem模块，成功启用了GDR功能，大幅提升了跨节点通信带宽性能。主要步骤包括：\n从GitHub获取nvidia-peermem源码 编译并安装内核模块 加载模块并验证功能 重新运行性能测试验证改进效果 这个解决方案适用于openEuler 22.03 SP3系统环境下的NVIDIA GPU集群配置。\n","permalink":"https://www.itwp.cn/categories/article/gdr01/","summary":"\u003ch2 id=\"场景描述\"\u003e场景描述\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eOS：\u003c/strong\u003e openEuler 22.03 SP3\u003c/p\u003e\n\u003cp\u003e项目操作系统使用openEuler 22.03 SP3，在进行跨节点 nccl-test 测试的时候发现 nvidia-peermem 无法加载使用RDMA。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e注意：\u003c/strong\u003e H200节点跨节点通信只有100+GB，因为没有开启GDR，所以默认走PCIE，链路瓶颈就在于PCIE\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"测试参数及带宽如下\"\u003e测试参数及带宽如下\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-0-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-1\"\u003e 1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-2\"\u003e 2\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-3\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-3\"\u003e 3\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-4\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-4\"\u003e 4\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-5\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-5\"\u003e 5\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-6\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-6\"\u003e 6\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-7\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-7\"\u003e 7\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-8\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-8\"\u003e 8\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-9\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-9\"\u003e 9\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-10\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-10\"\u003e10\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-11\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-11\"\u003e11\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-12\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-12\"\u003e12\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-13\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-13\"\u003e13\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003empirun \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--allow-run-as-root \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--prefix /usr/local/openmpi \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-H 1.1.1.1:8,1.1.1.2:8 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-mca btl_tcp_if_exclude lo,docker0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eLD_LIBRARY_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/cuda/lib64:/usr/local/openmpi/lib/:/root/test_env/nccl/build/lib/ \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x PATH \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_IB_DISABLE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_IB_HCA\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emlx5_0,mlx5_1,mlx5_2,mlx5_3,mlx5_4,mlx5_7,mlx5_8,mlx5_9 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_DEBUG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eINFO \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_IB_QPS_PER_CONNECTION\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_SOCKET_IFNAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebond4.24 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e./build/all_reduce_perf -b 8M -e 8G -g \u003cspan class=\"m\"\u003e1\u003c/span\u003e -f \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"测试结果截图1\" loading=\"lazy\" src=\"/images/gdr01/image1.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"问题解决\"\u003e问题解决\u003c/h2\u003e\n\u003cp\u003e从GitHub拉取nvidia-peermem进行编译\u003c/p\u003e\n\u003ch3 id=\"1-拉取nvidia-peermem源码\"\u003e1. 拉取nvidia-peermem源码\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-1-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo git clone https://github.com/Mellanox/nv_peer_memory.git\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"2-编译并安装nv_peer_memko\"\u003e2. 编译并安装nv_peer_mem.ko\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-2-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-2-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-2\"\u003e2\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-2-3\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-3\"\u003e3\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-2-4\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-4\"\u003e4\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e nv_peer_memory \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e make\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp nv_peer_mem.ko /lib/modules/\u003cspan class=\"k\"\u003e$(\u003c/span\u003euname -r\u003cspan class=\"k\"\u003e)\u003c/span\u003e/kernel/drivers/video\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edepmod -a\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emodprobe nv_peer_mem\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"3-检查模块加载状态\"\u003e3. 检查模块加载状态\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-3-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-3-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-2\"\u003e2\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 可通过lsmod|grep nv_peer_mem检查\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elsmod\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep nv_peer_mem\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"加载模块后的测试结果\"\u003e加载模块后的测试结果\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-4-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-1\"\u003e 1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-2\"\u003e 2\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-3\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-3\"\u003e 3\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-4\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-4\"\u003e 4\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-5\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-5\"\u003e 5\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-6\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-6\"\u003e 6\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-7\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-7\"\u003e 7\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-8\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-8\"\u003e 8\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-9\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-9\"\u003e 9\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-10\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-10\"\u003e10\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-11\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-11\"\u003e11\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-12\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-12\"\u003e12\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-13\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-13\"\u003e13\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-14\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-14\"\u003e14\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-15\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-15\"\u003e15\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-4-16\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-4-16\"\u003e16\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003empirun \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--allow-run-as-root \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--prefix /usr/local/openmpi \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-H 1.1.1.1:8,1.1.1.2:8 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-mca btl_tcp_if_exclude lo,docker0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eLD_LIBRARY_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/cuda/lib64:/usr/local/openmpi/lib/:/root/test_env/nccl/build/lib/ \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x PATH \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_IB_DISABLE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_IB_HCA\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emlx5_0,mlx5_1,mlx5_2,mlx5_3,mlx5_4,mlx5_7,mlx5_8,mlx5_9 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_IB_QPS_PER_CONNECTION\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_ALGO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eRing \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_DEBUG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eINFO \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_SOCKET_IFNAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eenp25s0np0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_IB_TC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e160\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-x \u003cspan class=\"nv\"\u003eNCCL_NET_GDR_LEVEL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e./build/all_reduce_perf -b 4G -e 32G -g \u003cspan class=\"m\"\u003e1\u003c/span\u003e -n \u003cspan class=\"m\"\u003e20\u003c/span\u003e -w \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"测试结果截图2\" loading=\"lazy\" src=\"/images/gdr01/image2.png\"\u003e\u003c/p\u003e","title":"[问题记录]GDR模块无法构建,重新编译nvidia-peermem"},{"content":"概述 在Windows Server环境中，网卡Bond（也称为网络组或NIC Teaming）可以提供网络冗余和负载均衡。本文将详细介绍如何使用PowerShell创建和管理网卡Bond。\n前提条件 Windows Server系统 至少两块网卡 管理员权限的PowerShell 配置步骤 1. 查看当前网卡列表 首先打开PowerShell（以管理员身份运行），执行以下命令查看当前网卡详情：\n1 Get-NetAdapter 此命令将显示系统中所有网络适配器的详细信息，包括：\n网卡名称 接口描述 连接状态 链路速度 2. 创建网卡Bond 使用New-NetSwitchTeam命令创建网卡Bond绑定。注意网卡名称之间的空格和引号使用：\n1 New-NetSwitchTeam -Name \u0026#34;bond1\u0026#34; -TeamMembers \u0026#34;以太网 2\u0026#34;,\u0026#34;以太网 3\u0026#34; 参数说明：\n-Name：指定Bond的名称 -TeamMembers：指定要加入Bond的物理网卡名称 重要提示：请根据步骤1中Get-NetAdapter的输出，准确填写要做Bond的物理网卡名称。\n3. 验证Bond配置 创建完成后，通过以下命令验证Bond是否设置成功：\n3.1 使用Get-NetAdapter验证 1 Get-NetAdapter 3.2 使用ipconfig验证 1 ipconfig /all 在输出中应该能看到新创建的Bond接口（bond1），并且原来的物理网卡状态会发生变化。\nVLAN配置（可选） 4. 配置VLAN标签 如果业务需求要求将Bond接口放通到特定VLAN（如VLAN 128），需要在物理接口上设置VLAN标签。\n注意：在创建Bond后，无法直接在Bond接口上设置VLAN标签，需要在各个物理接口（Slave接口）上分别设置。\n4.1 打开网络适配器设置 打开\u0026quot;网络和共享中心\u0026quot; 点击\u0026quot;更改适配器设置\u0026quot; 右键点击要配置的网卡，选择\u0026quot;属性\u0026quot; 选择\u0026quot;Microsoft 网络客户端\u0026quot; 4.2 设置VLAN ID 点击\u0026quot;配置\u0026quot;按钮 在\u0026quot;高级\u0026quot;选项卡中找到\u0026quot;VLAN ID\u0026quot;设置 填写交换机Trunk端口对应的VLAN号 配置说明：\nVLAN ID必须与交换机侧的配置保持一致 如果交换机使用Trunk模式，需要确保VLAN在允许列表中 两个物理接口都需要配置相同的VLAN ID 管理操作 删除Bond配置 如果需要移除Bond配置，使用以下命令：\n1 Remove-NetSwitchTeam -Name \u0026#34;bond1\u0026#34; 查看Bond状态 查看现有的网络组：\n1 Get-NetSwitchTeam 查看网络组成员：\n1 Get-NetSwitchTeamMember ","permalink":"https://www.itwp.cn/categories/article/windows-bond/","summary":"\u003ch2 id=\"概述\"\u003e概述\u003c/h2\u003e\n\u003cp\u003e在Windows Server环境中，网卡Bond（也称为网络组或NIC Teaming）可以提供网络冗余和负载均衡。本文将详细介绍如何使用PowerShell创建和管理网卡Bond。\u003c/p\u003e\n\u003ch2 id=\"前提条件\"\u003e前提条件\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eWindows Server系统\u003c/li\u003e\n\u003cli\u003e至少两块网卡\u003c/li\u003e\n\u003cli\u003e管理员权限的PowerShell\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"配置步骤\"\u003e配置步骤\u003c/h2\u003e\n\u003ch3 id=\"1-查看当前网卡列表\"\u003e1. 查看当前网卡列表\u003c/h3\u003e\n\u003cp\u003e首先打开PowerShell（以管理员身份运行），执行以下命令查看当前网卡详情：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-0-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-NetAdapter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"网卡列表查看\" loading=\"lazy\" src=\"/images/windows-bond/image1.png\"\u003e\u003c/p\u003e\n\u003cp\u003e此命令将显示系统中所有网络适配器的详细信息，包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e网卡名称\u003c/li\u003e\n\u003cli\u003e接口描述\u003c/li\u003e\n\u003cli\u003e连接状态\u003c/li\u003e\n\u003cli\u003e链路速度\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"2-创建网卡bond\"\u003e2. 创建网卡Bond\u003c/h3\u003e\n\u003cp\u003e使用\u003ccode\u003eNew-NetSwitchTeam\u003c/code\u003e命令创建网卡Bond绑定。\u003cstrong\u003e注意网卡名称之间的空格和引号使用\u003c/strong\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-1-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-NetSwitchTeam\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;bond1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-TeamMembers\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;以太网 2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;以太网 3\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e参数说明：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-Name\u003c/code\u003e：指定Bond的名称\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-TeamMembers\u003c/code\u003e：指定要加入Bond的物理网卡名称\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e重要提示\u003c/strong\u003e：请根据步骤1中\u003ccode\u003eGet-NetAdapter\u003c/code\u003e的输出，准确填写要做Bond的物理网卡名称。\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"3-验证bond配置\"\u003e3. 验证Bond配置\u003c/h3\u003e\n\u003cp\u003e创建完成后，通过以下命令验证Bond是否设置成功：\u003c/p\u003e\n\u003ch4 id=\"31-使用get-netadapter验证\"\u003e3.1 使用Get-NetAdapter验证\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-2-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-NetAdapter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"Bond配置验证\" loading=\"lazy\" src=\"/images/windows-bond/image2.png\"\u003e\u003c/p\u003e\n\u003ch4 id=\"32-使用ipconfig验证\"\u003e3.2 使用ipconfig验证\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-3-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eipconfig\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"IP配置详情\" loading=\"lazy\" src=\"/images/windows-bond/image3.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在输出中应该能看到新创建的Bond接口（bond1），并且原来的物理网卡状态会发生变化。\u003c/p\u003e\n\u003ch2 id=\"vlan配置可选\"\u003eVLAN配置（可选）\u003c/h2\u003e\n\u003ch3 id=\"4-配置vlan标签\"\u003e4. 配置VLAN标签\u003c/h3\u003e\n\u003cp\u003e如果业务需求要求将Bond接口放通到特定VLAN（如VLAN 128），需要在物理接口上设置VLAN标签。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e注意\u003c/strong\u003e：在创建Bond后，无法直接在Bond接口上设置VLAN标签，需要在各个物理接口（Slave接口）上分别设置。\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch4 id=\"41-打开网络适配器设置\"\u003e4.1 打开网络适配器设置\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003e打开\u0026quot;网络和共享中心\u0026quot;\u003c/li\u003e\n\u003cli\u003e点击\u0026quot;更改适配器设置\u0026quot;\u003c/li\u003e\n\u003cli\u003e右键点击要配置的网卡，选择\u0026quot;属性\u0026quot;\u003c/li\u003e\n\u003cli\u003e选择\u0026quot;Microsoft 网络客户端\u0026quot;\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg alt=\"网络客户端配置\" loading=\"lazy\" src=\"/images/windows-bond/image4.png\"\u003e\u003c/p\u003e\n\u003ch4 id=\"42-设置vlan-id\"\u003e4.2 设置VLAN ID\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003e点击\u0026quot;配置\u0026quot;按钮\u003c/li\u003e\n\u003cli\u003e在\u0026quot;高级\u0026quot;选项卡中找到\u0026quot;VLAN ID\u0026quot;设置\u003c/li\u003e\n\u003cli\u003e填写交换机Trunk端口对应的VLAN号\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg alt=\"VLAN ID配置\" loading=\"lazy\" src=\"/images/windows-bond/image5.png\"\u003e\u003c/p\u003e","title":"Windows Server网卡Bond配置指南"},{"content":"什么是NVIDIA DCGM？ NVIDIA 数据中心 GPU 管理器 (DCGM) 是一套专为管理和监控集群环境中的 NVIDIA 数据中心 GPU 而设计的综合工具集。它为数据中心提供了企业级的GPU管理解决方案。\n核心功能特性 主动运行状况监控 - 实时监控GPU健康状态 全面诊断 - 多级别的硬件诊断和性能测试 系统警报 - 智能告警系统和策略管理 治理策略 - 包括电源和时钟管理 易于集成 - 可轻松集成到现有的集群管理工具中 Kubernetes支持 - 通过DCGM-Exporter提供容器化环境支持 支持平台 DCGM 支持以下平台的 Linux 操作系统：\nx86_64 架构 Arm 架构 POWER (ppc64le) 架构 相关资源 官方网站: https://developer.nvidia.com/dcgm GitHub仓库: https://github.com/NVIDIA/DCGM 概述文档: https://docs.nvidia.com/datacenter/dcgm/latest/user-guide/getting-started.html 安装DCGM Ubuntu 22.04 环境部署 1. 获取安装包 根据你的系统架构选择对应的安装包：\nx86架构：\n1 2 # 下载地址 https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2204/x86_64/ ARM64架构（鲲鹏）：\n1 2 # 下载地址 https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2204/sbsa/ 2. 下载和安装 1 2 3 4 5 # 下载DCGM安装包 wget https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2204/x86_64/datacenter-gpu-manager_3.3.6_amd64.deb # 安装DCGM sudo dpkg -i datacenter-gpu-manager_3.3.6_amd64.deb 3. 验证安装 安装完成后，系统会包含以下关键二进制文件：\n文件路径 功能描述 /usr/bin/dcgmi DCGM管理命令行工具，用于管理和监控NVIDIA GPU /usr/bin/dcgmproftester10 DCGM性能检测工具第10版 /usr/bin/dcgmproftester11 DCGM性能检测工具第11版 /usr/bin/dcgmproftester12 DCGM性能检测工具第12版（推荐使用最新版本） /usr/bin/nv-hostengine NVIDIA主引擎服务，提供GPU管理和监控的底层支持 4. 启动DCGM服务 1 2 3 4 5 6 7 8 # 启动DCGM系统服务 sudo systemctl start nvidia-dcgm.service # 设置开机自启 sudo systemctl enable nvidia-dcgm.service # 检查服务状态 sudo systemctl status nvidia-dcgm.service DCGM基础使用 启动nv-hostengine 1 2 # 启动主机引擎（指定端口和绑定接口） nv-hostengine --port 5555 --bind-interface 127.0.0.1 设备发现和管理 查看GPU设备列表 1 2 3 4 5 # 发现所有GPU设备 dcgmi discovery --host 127.0.0.1:5555 -l # 或者简化命令 dcgmi discovery -l 群组管理 DCGM的大部分功能都是面向组的，因此需要先创建GPU组：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 查看现有群组 dcgmi group -l # 创建群组并添加GPU（将GPU ID 0-7添加到group 0） dcgmi group -g 0 -a 0,1,2,3,4,5,6,7 # 查看群组信息 dcgmi group -g 0 -i # 从群组中删除GPU设备 dcgmi group -g 0 -r 0,1,2,3,4,5,6,7 # 删除指定群组 dcgmi group -d 0 监控和诊断功能 统计监控 1 2 3 4 5 # 启用统计监控 dcgmi stats -g 0 --enable # 查看特定进程的统计信息 dcgmi stats --host 127.0.0.1:39999 -g 0 -p \u0026lt;进程PID\u0026gt; -v 健康检查 1 2 3 4 5 # 启用健康监控 dcgmi health -g 0 -s # 查看当前健康状态 dcgmi health --check -g 0 诊断测试 DCGM提供4个级别的诊断测试：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Level 1: 快速检查（基础系统验证） dcgmi diag -r 1 # 适用场景：快速检查GPU驱动、CUDA状态 # Level 2: 中等检查（扩展系统验证） dcgmi diag -r 2 # 适用场景：检查显存和计算单元基础功能，适合日常运维 # Level 3: 长期检查（硬件深度诊断） dcgmi diag -r 3 # 适用场景：深度硬件检查，如PCIe稳定性、温度监控 # Level 4: 扩展检查（长期压力测试） dcgmi diag -r 4 # 适用场景：长时间压力测试，排查偶发硬件故障 NVLink监控 1 2 3 4 5 # 检查NVLink错误计数器 dcgmi nvlink --errors -g 0 # 查看NVLink连接状态 dcgmi nvlink --link-status 配置管理 查看和修改GPU配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 查看当前配置 dcgmi config --host 127.0.0.1:39999 -g 0 --get -v # 修改计算模式 dcgmi config --host 127.0.0.1:39999 -g 0 --set -c 2 # 启用ECC模式 dcgmi config --host 127.0.0.1:39999 -g 0 --set -e on # 设置GPU功率限制（单位：W） dcgmi config --host 127.0.0.1:39999 -g 0 --set -p 300 # 设置时钟频率（内存2000MHz，SM时钟1200MHz） dcgmi config --host 127.0.0.1:39999 -g 0 --set -m 2000 -s 1200 策略管理 告警策略配置 1 2 3 4 5 6 7 8 9 10 11 # 查看当前策略 dcgmi policy --host 127.0.0.1:39999 -g 0 --get # 设置温度告警阈值（最大温度50°C） dcgmi policy --host 127.0.0.1:39999 -g 0 --set 0,0 -T 50 # 刷新策略 dcgmi policy --host 127.0.0.1:39999 -g 0 --reg # 清空所有策略 dcgmi policy --host 127.0.0.1:39999 -g 0 --clear DCGM Profiling性能分析 功能要求 使用DCGM Profiling功能需要满足以下条件：\nDCGM版本 ≥ 1.7 NVIDIA驱动版本 ≥ 418.43 nv-hostengine以root身份启动 支持的GPU型号：Tesla V100、Tesla T4等 可获取的性能指标 指标名称 说明 Field Name Graphics Engine Activity 图形引擎活跃度比率 PROF_GR_ENGINE_ACTIVE (ID: 1001) SM Activity SM单元活跃度比率 PROF_SM_ACTIVE (ID: 1002) SM Occupancy SM占用率 PROF_SM_OCCUPANCY (ID: 1003) Tensor Activity Tensor核心活跃度 PROF_PIPE_TENSOR_ACTIVE (ID: 1004) Memory BW Utilization 内存带宽利用率 PROF_DRAM_ACTIVE (ID: 1005) Engine Activity FP64/FP32/FP16/HMMA/IMMA管道活跃度 PROF_PIPE_FPXY_ACTIVE (多个ID) NVLink Activity NVLink传输字节数 DEV_NVLINK_BANDWIDTH_L0 PCIe Bandwidth PCIe传输字节数 PROF_PCIE_TX/RX_BYTES (ID: 1009/1010) 常用功能 1. 日常监控 定期运行Level 2诊断检查GPU基础功能 设置合理的温度和功率告警阈值 启用统计监控跟踪GPU使用率 2. 故障排查 使用Level 3/4诊断进行深度硬件检查 监控NVLink错误计数器识别连接问题 结合health检查功能定期评估GPU健康状态 3. 性能优化 利用Profiling功能分析GPU利用率 根据工作负载调整时钟频率和功率限制 监控内存带宽和计算单元占用率 4. 集群管理 将DCGM集成到Kubernetes环境中 使用DCGM-Exporter导出监控指标到Prometheus 建立自动化的GPU健康检查流程 个人实践经验 在实际的万卡GPU集群运维工作中，我总结了以下几点经验：\n运维要点 定期健康检查：建议每日运行Level 2诊断，每周进行Level 3深度检查 告警策略设置：根据业务特点设置合理的温度、功率告警阈值 日志监控：基于Prometheus、Grafana监控GPU状态变化，及时发现异常 监控集成 在Kubernetes环境中，推荐使用DCGM-Exporter结合Prometheus和Grafana构建完整的GPU监控体系：\n1 2 # 部署DCGM-Exporter到K8s集群 kubectl apply -f https://raw.githubusercontent.com/NVIDIA/dcgm-exporter/main/deployment/dcgm-exporter.yaml ","permalink":"https://www.itwp.cn/categories/article/dcgm01/","summary":"\u003ch3 id=\"什么是nvidia-dcgm\"\u003e什么是NVIDIA DCGM？\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eNVIDIA 数据中心 GPU 管理器 (DCGM)\u003c/strong\u003e 是一套专为管理和监控集群环境中的 NVIDIA 数据中心 GPU 而设计的综合工具集。它为数据中心提供了企业级的GPU管理解决方案。\u003c/p\u003e\n\u003ch3 id=\"核心功能特性\"\u003e核心功能特性\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e主动运行状况监控\u003c/strong\u003e - 实时监控GPU健康状态\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e全面诊断\u003c/strong\u003e - 多级别的硬件诊断和性能测试\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e系统警报\u003c/strong\u003e - 智能告警系统和策略管理\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e治理策略\u003c/strong\u003e - 包括电源和时钟管理\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e易于集成\u003c/strong\u003e - 可轻松集成到现有的集群管理工具中\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eKubernetes支持\u003c/strong\u003e - 通过DCGM-Exporter提供容器化环境支持\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"支持平台\"\u003e支持平台\u003c/h3\u003e\n\u003cp\u003eDCGM 支持以下平台的 Linux 操作系统：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ex86_64\u003c/code\u003e 架构\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eArm\u003c/code\u003e 架构\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePOWER (ppc64le)\u003c/code\u003e 架构\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"相关资源\"\u003e相关资源\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e官方网站: \u003ca href=\"https://developer.nvidia.com/dcgm\"\u003ehttps://developer.nvidia.com/dcgm\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eGitHub仓库: \u003ca href=\"https://github.com/NVIDIA/DCGM\"\u003ehttps://github.com/NVIDIA/DCGM\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e概述文档: \u003ca href=\"https://docs.nvidia.com/datacenter/dcgm/latest/user-guide/getting-started.html\"\u003ehttps://docs.nvidia.com/datacenter/dcgm/latest/user-guide/getting-started.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"安装dcgm\"\u003e安装DCGM\u003c/h2\u003e\n\u003ch3 id=\"ubuntu-2204-环境部署\"\u003eUbuntu 22.04 环境部署\u003c/h3\u003e\n\u003ch4 id=\"1-获取安装包\"\u003e1. 获取安装包\u003c/h4\u003e\n\u003cp\u003e根据你的系统架构选择对应的安装包：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ex86架构：\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-0-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-2\"\u003e2\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 下载地址\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2204/x86_64/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eARM64架构（鲲鹏）：\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-1-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-1-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-2\"\u003e2\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 下载地址  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2204/sbsa/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch4 id=\"2-下载和安装\"\u003e2. 下载和安装\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-2-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-2-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-2\"\u003e2\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-2-3\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-3\"\u003e3\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-2-4\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-4\"\u003e4\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-2-5\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-5\"\u003e5\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 下载DCGM安装包\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2204/x86_64/datacenter-gpu-manager_3.3.6_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 安装DCGM\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo dpkg -i datacenter-gpu-manager_3.3.6_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch4 id=\"3-验证安装\"\u003e3. 验证安装\u003c/h4\u003e\n\u003cp\u003e安装完成后，系统会包含以下关键二进制文件：\u003c/p\u003e","title":"NVIDIA DCGM01"},{"content":"1. lspci - 检查本地PCI设备 检查本地的PCI设备，用于识别Mellanox网卡。\n示例： lspci | grep -i mell\n2. ofed_info - 检测OFED驱动版本 检测OFED驱动版本信息。\n示例： ofed_info -s\n3. ibstat - 查看IB网卡状态 查看本机的InfiniBand网卡状态。\n4. mst - Mellanox软件管理工具 Mellanox软件管理工具，用来生成IB设备描述符，提供给其他命令使用。\n示例： mst start\n5. mlnx_perf - 查看端口收发流量 可以查看端口的收发流量。\n参数说明：\n-i：选项接IB设备名称，如ib0, ib1\u0026hellip; -t：每隔多久采集一次，单位秒 -c：采集多少次 6. ibswitches - 获取子网交换机信息 获取当前子网的所有交换机的信息。显示子网内所有识别到的交换机的GUID、端口数量、交换机名字、LID号等。\n7. ibhosts - 获取子网HCA信息 获取当前子网的所有HCA的信息。显示子网内所有识别到的HCA的GUID、端口数量、交换机名字、LID号等。\n8. ibnodes - 获取子网所有设备信息 获取当前子网的所有交换机和HCA的信息。显示子网内所有识别到的交换机和HCA的GUID、端口数量、交换机名字、LID号等。相当于ibhosts和ibswitches命令的合并。\n9. ibnetdiscover - 扫描IB网络设备 扫描当前网络中的IB设备。输出内容包括GUID、端口号、LID号和节点描述以及交换机和HCA卡的连接关系。\n10. iblinkinfo - 检查网络拓扑连接 检查网络拓扑是否按照最初规划的网络准确并连接正常，使用iblinkinfo，可以观察到所有节点和交换机的端口连接情况。\n输出解释 该交换机SW200总计有41个端口，第41个端口虚拟出来用来进行shield功能，实际不存在物理端口。第一列至最后一列是本端交换机LID端口号，with，速率，状态，物理状态，对端LID号，对端端口号，对端名字。\n标识说明：\n① 表示这台交换机的GUID号，唯一区分交换机的标识 ② LID号，集群创建时SM分配的唯一便于管理的lid号 ③ 表示1-20号口为IB交换模块与网卡连接的内部端口 ④ 表示21-40为IB交换模块外部连接口 ⑤ 表示41号口为虚拟机口，为集群跑压力的自由路由端口 ⑥ 表示当前端口的连接速率：4X*25.78125=100Gbps(EDR) ⑦ 表示网卡端口的lid号及所对应的服务器 ⑧ 表示IB交换模块外部连接口的lid号、端口序列号、对端连接设备的名称 11. ibdiagnet - 网络诊断工具 该指令扫描整个网络，诊断设备和网络连接状态，并生成报告。\n示例： 查看误码率 ibdiagnet --pc --get_phy_info\n生成的报告文件 ibdiagnet.log：全部应用信息报告 ibdiagnet.lst：网络所有节点、端口和链路信息列表 ibdiagnet.fdbs：网络全部交换机的单播转发表 ibdiagnet.mcfdbs：网络全部交换机的多播转发表 ibdiagnet.masks：重复GUID端口、节点掩码表 ibdiagnet.sm：网络所有子网管理器SM列表 ibdiagnet.pm：网络链路的性能管理器计数器信息 ibdiagnet.pkey：分区信息和成员主机端口信息 ibdiagnet.mcg：多播组属性，成员主机端口信息 ibdiagnet.db：内部子网数据库信息 12. sminfo - 获取子网管理器信息 获取当前节点的子网管理器的信息。\n⚠️ 注意： 禁止批量执行该命令，会引起opensm服务异常。\n13. saquery - 查看子网管理器 查看子网内的子网管理器。\n14. mget_temp - 获取设备温度 获取网卡或交换机的温度。\n15. mlxlink - 连接状态诊断工具 用于检查和调试连接状态以及与之相关的问题。\n重要参数说明 Speed：表示当前网卡支持的最大带宽速率 Enabled Link Speed：表示当前网卡支持的协商速率 Support Cable Speed：表示与IB交换模块连接的线缆支持的协商速率（红色字体表示为内部连接无cable） 常用功能 检查端口的误码率（-c参数） 查看光口的温度、线缆长度等 查询模块的信息 16. ibportstate - 端口管理工具 来管理交换机的端口，enable、reset、disable等等。如果交换机的端口disable了，连对端卡的状态就是polling。\n示例：\nibportstate 127 37 enable # 启动lid为127的交换机的37号端口 ibportstate 127 37 # 查看lid为127的交换机的37号端口 17. perfquery - 查看端口计数器 查看端口计数器，主要用来排错。\n示例：\nperfquery 32 2：显示lid号为32的设备的2号端口的计数器 perfquery -l 26 1-10 -r：分别显示lid号为26的设备的1-10号端口的计数器 参数说明：\n-r：读取指定的端口计数器之后，重新开始计数 -l：显示每一个端口的数据 -a：将所有端口，数据汇聚后，展示 18. ib_send_bw - 带宽测试工具 测试两个节点的带宽。\n常用参数 -a：Run sizes from 2 till 2^23 -c：指定连接类型 RC：面向连接的可靠服务 UC：面向连接的不可靠服务 UD：面向数据包的不可靠服务 -F：表示屏蔽掉CPU频率相关的提示信息 -d：表示卡的id -i：指定网卡的端口 使用示例 服务端： ib_send_bw -a -c UD -F -d mlx5_0\n客户端： ib_send_bw -a -c UD -F -d mlx5_0 11.4.3.19\n19. hca_self_test.ofed - 自检工具 自检工具，通常用于验证OFED（OpenFabrics Enterprise Distribution）软件栈和硬件设备的兼容性与功能完整性。\n主要功能 硬件诊断：检测Mellanox HCA（如ConnectX系列）的物理状态（端口、链路、固件等） 软件兼容性：验证OFED驱动、固件版本、内核模块是否匹配 功能测试：检查RDMA（远程直接内存访问）、NVMe over Fabrics（NVMe-oF）等高级功能是否正常 ","permalink":"https://www.itwp.cn/categories/article/mellanox_cmd01/","summary":"\u003ch2 id=\"1-lspci---检查本地pci设备\"\u003e1. lspci - 检查本地PCI设备\u003c/h2\u003e\n\u003cp\u003e检查本地的PCI设备，用于识别Mellanox网卡。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例：\u003c/strong\u003e \u003ccode\u003elspci | grep -i mell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"lspci命令输出\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235100379.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2-ofed_info---检测ofed驱动版本\"\u003e2. ofed_info - 检测OFED驱动版本\u003c/h2\u003e\n\u003cp\u003e检测OFED驱动版本信息。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例：\u003c/strong\u003e \u003ccode\u003eofed_info -s\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"OFED版本信息\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235137676.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"3-ibstat---查看ib网卡状态\"\u003e3. ibstat - 查看IB网卡状态\u003c/h2\u003e\n\u003cp\u003e查看本机的InfiniBand网卡状态。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"ibstat命令输出\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235214168.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"4-mst---mellanox软件管理工具\"\u003e4. mst - Mellanox软件管理工具\u003c/h2\u003e\n\u003cp\u003eMellanox软件管理工具，用来生成IB设备描述符，提供给其他命令使用。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例：\u003c/strong\u003e \u003ccode\u003emst start\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"mst命令输出\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235301084.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"5-mlnx_perf---查看端口收发流量\"\u003e5. mlnx_perf - 查看端口收发流量\u003c/h2\u003e\n\u003cp\u003e可以查看端口的收发流量。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e参数说明：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-i\u003c/code\u003e：选项接IB设备名称，如ib0, ib1\u0026hellip;\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-t\u003c/code\u003e：每隔多久采集一次，单位秒\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-c\u003c/code\u003e：采集多少次\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"mlnx_perf命令输出\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235344273.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"6-ibswitches---获取子网交换机信息\"\u003e6. ibswitches - 获取子网交换机信息\u003c/h2\u003e\n\u003cp\u003e获取当前子网的所有交换机的信息。显示子网内所有识别到的交换机的GUID、端口数量、交换机名字、LID号等。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"ibswitches命令输出\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235453996.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"7-ibhosts---获取子网hca信息\"\u003e7. ibhosts - 获取子网HCA信息\u003c/h2\u003e\n\u003cp\u003e获取当前子网的所有HCA的信息。显示子网内所有识别到的HCA的GUID、端口数量、交换机名字、LID号等。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"ibhosts命令输出\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235510830.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"8-ibnodes---获取子网所有设备信息\"\u003e8. ibnodes - 获取子网所有设备信息\u003c/h2\u003e\n\u003cp\u003e获取当前子网的所有交换机和HCA的信息。显示子网内所有识别到的交换机和HCA的GUID、端口数量、交换机名字、LID号等。相当于ibhosts和ibswitches命令的合并。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"ibnodes命令输出\" loading=\"lazy\" src=\"/images/mellanox01/image-20250904235532118.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"9-ibnetdiscover---扫描ib网络设备\"\u003e9. ibnetdiscover - 扫描IB网络设备\u003c/h2\u003e\n\u003cp\u003e扫描当前网络中的IB设备。输出内容包括GUID、端口号、LID号和节点描述以及交换机和HCA卡的连接关系。\u003c/p\u003e","title":"Mellanox网卡常用命令详解"},{"content":"1. 检查nvidia-smi状态 首先使用nvidia-smi命令查看当前GPU状态：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 ubuntu@ubuntu:~$ nvidia-smi +-----------------------------------------------------------------------------+ | NVIDIA-SMI 430.14 Driver Version: 430.14 CUDA Version: 10.2 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 GeForce RTX 208... Off | 00000000:1B:00.0 Off | N/A | | 22% 42C P0 63W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 1 GeForce RTX 208... Off | 00000000:1C:00.0 Off | N/A | | 23% 43C P0 57W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 2 GeForce RTX 208... Off | 00000000:1D:00.0 Off | N/A | | 23% 43C P0 62W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 3 GeForce RTX 208... Off | 00000000:1E:00.0 Off | N/A | | 22% 42C P0 49W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 4 GeForce RTX 208... Off | 00000000:89:00.0 Off | N/A | | 22% 41C P0 75W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 5 GeForce RTX 208... Off | 00000000:8A:00.0 Off | N/A | | 22% 43C P0 63W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 6 GeForce RTX 208... Off | 00000000:8B:00.0 Off | N/A | | 22% 41C P0 50W / 250W | 0MiB / 11019MiB | 1% Default | +-------------------------------+----------------------+----------------------+ | 7 GeForce RTX 208... Off | 00000000:8C:00.0 Off | N/A | | 20% 41C P0 54W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | No running processes found | +-----------------------------------------------------------------------------+ 2. 模拟GPU移除操作 通过PCI设备管理接口手动移除特定GPU：\n1 ubuntu@ubuntu:~$ sudo echo 1 \u0026gt; /sys/bus/pci/devices/0000:8a:00.0/remove 执行后再次检查nvidia-smi状态：\n1 ubuntu@ubuntu:~$ nvidia-smi 移除GPU后的输出示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 +-----------------------------------------------------------------------------+ | NVIDIA-SMI 430.14 Driver Version: 430.14 CUDA Version: 10.2 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 GeForce RTX 208... Off | 00000000:1B:00.0 Off | N/A | | 22% 42C P0 63W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 1 GeForce RTX 208... Off | 00000000:1C:00.0 Off | N/A | | 24% 44C P0 55W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 2 GeForce RTX 208... Off | 00000000:1D:00.0 Off | N/A | | 23% 43C P0 61W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 3 GeForce RTX 208... Off | 00000000:1E:00.0 Off | N/A | | 22% 42C P0 50W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ | 4 GeForce RTX 208... Off | 00000000:89:00.0 Off | N/A | | 25% 44C P2 77W / 250W | 10527MiB / 11019MiB | 12% Default | +-------------------------------+----------------------+----------------------+ | 5 GeForce RTX 208... Off | 00000000:8B:00.0 Off | N/A | | 22% 40C P0 49W / 250W | 0MiB / 11019MiB | 1% Default | +-------------------------------+----------------------+----------------------+ | 6 GeForce RTX 208... Off | 00000000:8C:00.0 Off | N/A | | 19% 40C P0 54W / 250W | 0MiB / 11019MiB | 0% Default | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | 4 6149 C python 10517MiB | +-----------------------------------------------------------------------------+ 注： 可以看到原本的GPU 5（Bus ID: 8A:00.0）已经不可见，GPU数量从8个减少到7个。\n3. 重新扫描PCI设备 使用以下命令重新扫描PCI总线，将新设备添加到系统中：\n1 echo 1 \u0026gt; /sys/bus/pci/rescan 此命令用于扫描PCI总线上的设备，并将新设备添加到系统中。\n获取GPU Bus ID信息 方法1：使用lspci查看VGA控制器 1 ubuntu@ubuntu:~$ lspci | grep VGA 输出示例：\n1 2 3 4 5 6 7 8 03:00.0 VGA compatible controller: ASPEED Technology, Inc. ASPEED Graphics Family (rev 41) 1b:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 1c:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 1d:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 1e:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 89:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 8b:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 8c:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 方法2：使用nvidia-smi查看Bus ID 1 ubuntu@ubuntu:~$ nvidia-smi -a | grep \u0026#34;Bus Id\u0026#34; 输出示例：\n1 2 3 4 5 6 7 Bus Id : 00000000:1B:00.0 Bus Id : 00000000:1C:00.0 Bus Id : 00000000:1D:00.0 Bus Id : 00000000:1E:00.0 Bus Id : 00000000:89:00.0 Bus Id : 00000000:8B:00.0 Bus Id : 00000000:8C:00.0 方法3：使用lspci查看所有NVIDIA设备 1 ubuntu@ubuntu:~$ lspci | grep -i nvidia 输出示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 1b:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 1b:00.1 Audio device: NVIDIA Corporation Device 10f7 (rev a1) 1b:00.2 USB controller: NVIDIA Corporation Device 1ad6 (rev a1) 1b:00.3 Serial bus controller [0c80]: NVIDIA Corporation Device 1ad7 (rev a1) 1c:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1) 1c:00.1 Audio device: NVIDIA Corporation Device 10f7 (rev a1) 1c:00.2 USB controller: NVIDIA Corporation Device 1ad6 (rev a1) 1c:00.3 Serial bus controller [0c80]: NVIDIA Corporation Device 1ad7 (rev a1) [...] 8a:00.1 Audio device: NVIDIA Corporation Device 10f7 (rev a1) 8a:00.2 USB controller: NVIDIA Corporation Device 1ad6 (rev a1) 8a:00.3 Serial bus controller [0c80]: NVIDIA Corporation Device 1ad7 (rev a1) [...] 注意： 在这个输出中可以看到8a:00.1、8a:00.2、8a:00.3设备存在，但8a:00.0（主VGA控制器）缺失，这证实了该GPU确实被移除。\n","permalink":"https://www.itwp.cn/categories/article/no_gpu/","summary":"\u003ch3 id=\"1-检查nvidia-smi状态\"\u003e1. 检查nvidia-smi状态\u003c/h3\u003e\n\u003cp\u003e首先使用\u003ccode\u003envidia-smi\u003c/code\u003e命令查看当前GPU状态：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-0-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-1\"\u003e 1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-2\"\u003e 2\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-3\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-3\"\u003e 3\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-4\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-4\"\u003e 4\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-5\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-5\"\u003e 5\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-6\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-6\"\u003e 6\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-7\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-7\"\u003e 7\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-8\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-8\"\u003e 8\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-9\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-9\"\u003e 9\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-10\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-10\"\u003e10\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-11\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-11\"\u003e11\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-12\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-12\"\u003e12\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-13\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-13\"\u003e13\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-14\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-14\"\u003e14\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-15\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-15\"\u003e15\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-16\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-16\"\u003e16\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-17\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-17\"\u003e17\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-18\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-18\"\u003e18\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-19\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-19\"\u003e19\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-20\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-20\"\u003e20\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-21\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-21\"\u003e21\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-22\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-22\"\u003e22\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-23\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-23\"\u003e23\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-24\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-24\"\u003e24\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-25\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-25\"\u003e25\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-26\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-26\"\u003e26\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-27\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-27\"\u003e27\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-28\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-28\"\u003e28\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-29\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-29\"\u003e29\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-30\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-30\"\u003e30\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-31\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-31\"\u003e31\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-32\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-32\"\u003e32\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-33\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-33\"\u003e33\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-34\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-34\"\u003e34\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-35\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-35\"\u003e35\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-36\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-36\"\u003e36\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-37\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-37\"\u003e37\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-38\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-38\"\u003e38\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-39\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-39\"\u003e39\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eubuntu@ubuntu:~$ nvidia-smi\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-----------------------------------------------------------------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e NVIDIA-SMI 430.14       Driver Version: 430.14       CUDA Version: 10.2   \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e GPU  Name        Persistence-M\u003cspan class=\"p\"\u003e|\u003c/span\u003e Bus-Id        Disp.A \u003cspan class=\"p\"\u003e|\u003c/span\u003e Volatile Uncorr. ECC \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Fan  Temp  Perf  Pwr:Usage/Cap\u003cspan class=\"p\"\u003e|\u003c/span\u003e         Memory-Usage \u003cspan class=\"p\"\u003e|\u003c/span\u003e GPU-Util  Compute M. \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"o\"\u003e===============================\u003c/span\u003e+\u003cspan class=\"o\"\u003e======================\u003c/span\u003e+\u003cspan class=\"o\"\u003e======================\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e0\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:1B:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 22%   42C    P0    63W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e1\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:1C:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 23%   43C    P0    57W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e2\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:1D:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 23%   43C    P0    62W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e3\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:1E:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 22%   42C    P0    49W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e4\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:89:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 22%   41C    P0    75W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e5\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:8A:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 22%   43C    P0    63W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e6\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:8B:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 22%   41C    P0    50W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      1%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e7\u003c/span\u003e  GeForce RTX 208...  Off  \u003cspan class=\"p\"\u003e|\u003c/span\u003e 00000000:8C:00.0 Off \u003cspan class=\"p\"\u003e|\u003c/span\u003e                  N/A \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 20%   41C    P0    54W / 250W \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0MiB / 11019MiB \u003cspan class=\"p\"\u003e|\u003c/span\u003e      0%      Default \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-------------------------------+----------------------+----------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-----------------------------------------------------------------------------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Processes:                                                       GPU Memory \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e  GPU       PID   Type   Process name                             Usage      \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"o\"\u003e=============================================================================\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e  No running processes found                                                 \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+-----------------------------------------------------------------------------+\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"2-模拟gpu移除操作\"\u003e2. 模拟GPU移除操作\u003c/h3\u003e\n\u003cp\u003e通过PCI设备管理接口手动移除特定GPU：\u003c/p\u003e","title":"系统下屏蔽GPU显卡"},{"content":"一. 基础环境准备 1. 系统优化 1. 锁定内核版本 防止系统自动升级导致驱动不兼容：\n1 apt-mark hold linux-generic linux-image-generic linux-headers-generic 2. 关闭自动更新 1 2 sudo sed -i.bak \u0026#39;s/1/0/\u0026#39; /etc/apt/apt.conf.d/10periodic \u0026amp;\u0026gt; /dev/null sudo sed -i.bak \u0026#39;s/1/0/\u0026#39; /etc/apt/apt.conf.d/20auto-upgrades \u0026amp;\u0026gt; /dev/null 2. 依赖安装 安装编译必需的工具：\n1 apt install gcc make -y 二. 驱动下载 1. NVIDIA Driver下载 访问NVIDIA官方驱动下载页面： 官方链接: https://www.nvidia.cn/drivers/lookup/\n根据您的GPU型号和操作系统版本选择合适的驱动版本。下载后会获得一个.run安装包，直接上传到服务器即可。\n2. CUDA下载 访问NVIDIA CUDA下载页面： 官方链接: https://developer.nvidia.com/cuda-downloads\n选择对应的操作系统、架构和版本，推荐下载.run格式的安装包，便于自定义安装选项。\n3. NVIDIA Fabric Manager下载 注：仅SXM接口的GPU需要，PCIe接口的GPU不需要此组件。\n1 wget https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2004/x86_64/nvidia-fabricmanager-535_535.154.05-1_amd64.deb 三. 驱动安装 1. NVIDIA Driver安装 使用以下命令安装NVIDIA驱动（根据实际版本号修改）：\n1 2 3 4 5 6 ./NVIDIA-Linux-x86_64-535.154.05.run \\ --ui=none \\ --no-questions \\ --accept-license \\ --disable-nouveau \\ --install-libglvnd 2. CUDA安装 安装CUDA Toolkit（根据实际版本号修改）：\n1 2 3 4 5 6 ./cuda_12.2.0_535.154.05_linux.run \\ --silent \\ --toolkit \\ --override \\ --no-drm \\ --no-opengl-libs 3. NVIDIA Fabric Manager安装 仅适用于SXM接口的GPU（如A800、A100）：\n1 dpkg -i nvidia-fabricmanager-535_535.154.05-1_amd64.deb 四. 服务配置 1. NVIDIA Fabric Manager服务 启用和配置Fabric Manager服务（用于NVLink连接）：\n1 2 3 systemctl daemon-reload systemctl start nvidia-fabricmanager systemctl enable nvidia-fabricmanager 2. NVIDIA Persistence Daemon 创建并启用NVIDIA持久化守护程序：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 cat \u0026lt;\u0026lt; EOF \u0026gt; /lib/systemd/system/nvidia-persistenced.service [Unit] Description=NVIDIA Persistence Daemon After=syslog.target [Service] Type=forking PIDFile=/var/run/nvidia-persistenced/nvidia-persistenced.pid Restart=always ExecStart=/usr/bin/nvidia-persistenced --verbose ExecStopPost=/bin/rm -rf /var/run/nvidia-persistenced/* TimeoutSec=300 [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable nvidia-persistenced systemctl start nvidia-persistenced 五. 环境配置 1. CUDA环境设置 将CUDA路径添加到系统环境变量：\n1 2 3 4 5 6 7 cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/profile export PATH=/usr/local/cuda/bin:$PATH export CUDA_HOME=/usr/local/cuda/ export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH export LD_LIBRARY_PATH=/usr/local/cuda/targets/x86_64-linux/lib:$LD_LIBRARY_PATH export LD_LIBRARY_PATH=/usr/local/cuda/targets/x86_64-linux/lib/stubs:$LD_LIBRARY_PATH EOF 加载环境变量：\n1 source /etc/profile 六. 环境验证 1. nvidia-smi验证 运行nvidia-smi命令验证驱动安装：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 nvidia-smi +-----------------------------------------------------------------------------+ | NVIDIA-SMI 535.154.05 Driver Version: 535.154.05 CUDA Version: 12.2 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |===============================+======================+======================| | 0 NVIDIA A800-SXM4-80GB On | 00000000:10:00.0 Off | 0 | | N/A 41C P0 62W / 400W | 0MiB / 81920MiB | 0% Default | | | | Disabled | +-------------------------------+----------------------+----------------------+ | 1 NVIDIA A800-SXM4-80GB On | 00000000:16:00.0 Off | 0 | | N/A 39C P0 63W / 400W | 0MiB / 81920MiB | 0% Default | | | | Disabled | +-------------------------------+----------------------+----------------------+ ... 2. NVIDIA Fabric Manager 检查Fabric Manager服务状态：\n1 2 3 4 5 6 7 8 9 10 11 systemctl status nvidia-fabricmanager ● nvidia-fabricmanager.service - NVIDIA fabric manager service Loaded: loaded (/lib/systemd/system/nvidia-fabricmanager.service; enabled; vendor preset: enabled) Active: active (running) since Mon 2023-05-07 08:33:50 CST; 3 months 20 days ago Main PID: 2979 (nv-fabricmanage) Tasks: 18 (limit: 629145) Memory: 17.9M CPU: 19min 27.766s CGroup: /system.slice/nvidia-fabricmanager.service └─2979 /usr/bin/nv-fabricmanager -c /usr/share/nvidia/nvswitch/fabricmanager.cfg 3. NVIDIA Persistence Daemon验证 检查持久化守护程序状态：\n1 2 3 4 5 6 7 8 9 10 11 systemctl status nvidia-persistenced ● nvidia-persistenced.service - NVIDIA Persistence Daemon Loaded: loaded (/lib/systemd/system/nvidia-persistenced.service; enabled; vendor preset: enabled) Active: active (running) since Fri 2023-05-07 15:13:59 CST; 3 months 16 days ago Main PID: 304182 (nvidia-persiste) Tasks: 1 (limit: 629145) Memory: 360.0K CPU: 214ms CGroup: /system.slice/nvidia-persistenced.service └─304182 /usr/bin/nvidia-persistenced --verbose ","permalink":"https://www.itwp.cn/categories/article/ubuntu-nvidia/","summary":"\u003ch2 id=\"一-基础环境准备\"\u003e一. 基础环境准备\u003c/h2\u003e\n\u003ch3 id=\"1-系统优化\"\u003e1. 系统优化\u003c/h3\u003e\n\u003ch4 id=\"1-锁定内核版本\"\u003e1. 锁定内核版本\u003c/h4\u003e\n\u003cp\u003e防止系统自动升级导致驱动不兼容：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-0-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt-mark hold linux-generic linux-image-generic linux-headers-generic\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch4 id=\"2-关闭自动更新\"\u003e2. 关闭自动更新\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-1-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-1-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-2\"\u003e2\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo sed -i.bak \u003cspan class=\"s1\"\u003e\u0026#39;s/1/0/\u0026#39;\u003c/span\u003e /etc/apt/apt.conf.d/10periodic \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo sed -i.bak \u003cspan class=\"s1\"\u003e\u0026#39;s/1/0/\u0026#39;\u003c/span\u003e /etc/apt/apt.conf.d/20auto-upgrades \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"2-依赖安装\"\u003e2. 依赖安装\u003c/h3\u003e\n\u003cp\u003e安装编译必需的工具：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-2-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-2-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install gcc make -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"二-驱动下载\"\u003e二. 驱动下载\u003c/h2\u003e\n\u003ch3 id=\"1-nvidia-driver下载\"\u003e1. NVIDIA Driver下载\u003c/h3\u003e\n\u003cp\u003e访问NVIDIA官方驱动下载页面：\n官方链接: \u003ca href=\"https://www.nvidia.cn/drivers/lookup/\"\u003ehttps://www.nvidia.cn/drivers/lookup/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"NVIDIA驱动下载页面\" loading=\"lazy\" src=\"/images/ubuntu-nvidia/image1.png\"\u003e\u003c/p\u003e\n\u003cp\u003e根据您的GPU型号和操作系统版本选择合适的驱动版本。下载后会获得一个\u003ccode\u003e.run\u003c/code\u003e安装包，直接上传到服务器即可。\u003c/p\u003e\n\u003ch3 id=\"2-cuda下载\"\u003e2. CUDA下载\u003c/h3\u003e\n\u003cp\u003e访问NVIDIA CUDA下载页面：\n官方链接: \u003ca href=\"https://developer.nvidia.com/cuda-downloads\"\u003ehttps://developer.nvidia.com/cuda-downloads\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"CUDA下载页面\" loading=\"lazy\" src=\"/images/ubuntu-nvidia/image2.png\"\u003e\u003c/p\u003e\n\u003cp\u003e选择对应的操作系统、架构和版本，推荐下载\u003ccode\u003e.run\u003c/code\u003e格式的安装包，便于自定义安装选项。\u003c/p\u003e\n\u003ch3 id=\"3-nvidia-fabric-manager下载\"\u003e3. NVIDIA Fabric Manager下载\u003c/h3\u003e\n\u003cp\u003e注：仅SXM接口的GPU需要，PCIe接口的GPU不需要此组件。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-3-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-3-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2004/x86_64/nvidia-fabricmanager-535_535.154.05-1_amd64.deb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"三-驱动安装\"\u003e三. 驱动安装\u003c/h2\u003e\n\u003ch3 id=\"1-nvidia-driver安装\"\u003e1. NVIDIA Driver安装\u003c/h3\u003e\n\u003cp\u003e使用以下命令安装NVIDIA驱动（根据实际版本号修改）：\u003c/p\u003e","title":"Ubuntu NVIDIA驱动部署"},{"content":"物理机部署 rocm 超算GPU平台 https://download.pytorch.org/whl/torch_stable.html\nsource /opt/rocm/env.sh 或者 module load /root/dtkxxx\nenv.sh 内容如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/bash # get DTKROOT by env.sh location DTKROOT=\u0026#34;$(cd \u0026#34;$(dirname \u0026#34;${BASH_SOURCE[0]}\u0026#34;)\u0026#34; \u0026amp;\u0026amp; pwd)/$(basename \u0026#34;${BASH_SOURCE[0]}\u0026#34;)\u0026#34; export DTKROOT=$(dirname $DTKROOT) export AMDGPU_TARGETS=\u0026#34;gfx906\u0026#34; export ROCM_PATH=$DTKROOT export HIP_PATH=${ROCM_PATH}/hip export PATH=$ROCM_PATH/bin:$ROCM_PATH/opencl/bin:$ROCM_PATH/llvm/bin:$ROCM_PATH/hip/bin:$PATH export LD_LIBRARY_PATH=${ROCM_PATH}/lib:${ROCM_PATH}/opencl/lib:${ROCM_PATH}/lib64:$LD_LIBRARY_PATH export LD_LIBRARY_PATH=${ROCM_PATH}/hip/lib:${ROCM_PATH}/llvm/lib:$LD_LIBRARY_PATH export C_INCLUDE_PATH=${ROCM_PATH}/include:${ROCM_PATH}/llvm/include${C_INCLUDE_PATH:+:${C_INCLUDE_PATH}} export CPLUS_INCLUDE_PATH=${ROCM_PATH}/include:${ROCM_PATH}/llvm/include${CPLUS_INCLUDE_PATH:+:${CPLUS_INCLUDE_PATH}} rocm-smi 查看GPU\ndocker 部署eth \u0026ndash;gfx906 超算GPU平台 1 docker run -it --name testa1 --env-file ./env --device=/dev/dri --device=/dev/kfd jupyter:v1 /bin/bash 说明：\n--device 指定GPU驱动路径 --env-file 指定env文件，本文件内声明代理节点，用于代理上网 env文件内容如下:\n1 2 3 proxy=http://sugonhsq:HfJSZ*j*@10.10.101.4:3333 http_proxy=http://sugonhsq:HfJSZ*j*@10.10.101.4:3333 https_proxy=http://sugonhsq:HfJSZ*j*@10.10.101.4:3333 调用redmini：\n--benchmark 会模拟一个服务器，不把地址发送出去\n1 ./teamredminer -a ethash --benchmark -o stratum+ssl://156.226.17.84:6677 -u 0x9Eefd5CB1CD01574bac349a9a92b01064FEF543C -p x FAQ docker 中无法调用opencl 说明：\nopencl路径：/opt/rocm/opencl/bin/clinfo 设置变量 PATH=$PATH:/opt/rocm/opencl/bin/ [root@localhost ~]# rocm-smi 显示 \u0026ldquo;There are no card\u0026rdquo; 问题处理：\n1. 无法使用clinfo 查看opencl平台 解决办法：docker 镜像中创建一个文件路径如下\n1 2 mkdir -p /etc/OpenCL/vendors/ vim /etc/OpenCL/vendors/amdocl64.icd 文件内容：\n1 libamdocl64.so 2. 创建库文件后还是报错，需要声明变量 1 2 export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/dtk/opencl/lib export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/rocm/opencl/lib 配置：\n1 permitRootLogin yes teamredminer - 声明一下opencl的路径\n3. \u0026ldquo;there are no card\u0026quot;报错 更新内核后和驱动不适配，不能更新内核\n曙光方德系统查看显卡状态 差别 hy-smi 和 rocm-smi 的区别 hy-smi:\nhy-smi就是封装的rocm-smi 可以这样理解dtk就是把rocm封装了下，在dcu1-2号都能用 rocm-smi:\n不过rocm-smi 是直接调用的 rocm超算平台 本质上没什区别 sugon方德系统:\n内核版本 957 如下图\n","permalink":"https://www.itwp.cn/categories/article/rocm-docker/","summary":"\u003ch2 id=\"物理机部署-rocm-超算gpu平台\"\u003e物理机部署 rocm 超算GPU平台\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://download.pytorch.org/whl/torch_stable.html\"\u003ehttps://download.pytorch.org/whl/torch_stable.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003esource /opt/rocm/env.sh 或者 module load /root/dtkxxx\u003c/p\u003e\n\u003cp\u003eenv.sh 内容如下\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-0-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-1\"\u003e 1\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-2\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-2\"\u003e 2\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-3\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-3\"\u003e 3\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-4\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-4\"\u003e 4\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-5\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-5\"\u003e 5\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-6\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-6\"\u003e 6\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-7\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-7\"\u003e 7\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-8\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-8\"\u003e 8\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-9\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-9\"\u003e 9\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-10\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-10\"\u003e10\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-11\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-11\"\u003e11\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-12\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-12\"\u003e12\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-13\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-13\"\u003e13\u003c/a\u003e\n\u003c/span\u003e\u003cspan class=\"lnt\" id=\"hl-0-14\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-0-14\"\u003e14\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# get DTKROOT by env.sh location\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDTKROOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edirname \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eBASH_SOURCE\u003c/span\u003e\u003cspan class=\"p\"\u003e[0]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003epwd\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ebasename \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eBASH_SOURCE\u003c/span\u003e\u003cspan class=\"p\"\u003e[0]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eDTKROOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edirname \u003cspan class=\"nv\"\u003e$DTKROOT\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eAMDGPU_TARGETS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;gfx906\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$DTKROOT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eHIP_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/hip\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ROCM_PATH\u003c/span\u003e/bin:\u003cspan class=\"nv\"\u003e$ROCM_PATH\u003c/span\u003e/opencl/bin:\u003cspan class=\"nv\"\u003e$ROCM_PATH\u003c/span\u003e/llvm/bin:\u003cspan class=\"nv\"\u003e$ROCM_PATH\u003c/span\u003e/hip/bin:\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eLD_LIBRARY_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/lib:\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/opencl/lib:\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/lib64:\u003cspan class=\"nv\"\u003e$LD_LIBRARY_PATH\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eLD_LIBRARY_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/hip/lib:\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/llvm/lib:\u003cspan class=\"nv\"\u003e$LD_LIBRARY_PATH\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eC_INCLUDE_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/include:\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/llvm/include\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eC_INCLUDE_PATH\u003c/span\u003e\u003cspan class=\"p\"\u003e:+:\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eC_INCLUDE_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eCPLUS_INCLUDE_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/include:\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eROCM_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/llvm/include\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCPLUS_INCLUDE_PATH\u003c/span\u003e\u003cspan class=\"p\"\u003e:+:\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCPLUS_INCLUDE_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003erocm-smi 查看GPU\u003c/p\u003e\n\u003ch2 id=\"docker-部署eth-gfx906-超算gpu平台\"\u003edocker 部署eth \u0026ndash;gfx906 超算GPU平台\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\" id=\"hl-1-1\"\u003e\u003ca class=\"lnlinks\" href=\"#hl-1-1\"\u003e1\u003c/a\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -it --name testa1 --env-file ./env --device\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/dri --device\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/kfd jupyter:v1 /bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e说明：\u003c/p\u003e","title":"Docker调用ROCM"}]